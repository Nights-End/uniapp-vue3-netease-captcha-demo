require("./../../runtime"),require("./../../common"),(my.neCaptchaJsonp=my.neCaptchaJsonp||[]).push([[2],{20:function(t,e,a){"use strict";var n=d(a(1)),r=a(0),i=a(2),s=d(i),o=d(a(10)),u=d(a(6)),c=d(a(11)),f=a(5),h=a(3),p=d(a(4));function d(t){return t&&t.__esModule?t:{default:t}}function l(t){return function(){var e=t.apply(this,arguments);return new Promise((function(t,a){return function n(r,i){try{var s=e[r](i),o=s.value}catch(t){return void a(t)}if(!s.done)return Promise.resolve(o).then((function(t){n("next",t)}),(function(t){n("throw",t)}));t(o)}("next")}))}}var y,v;Component({mixins:[p.default],props:{onInit:function(){},onReady:function(){},onVerify:function(){},onError:function(){}},data:{beginTime:0,isReady:!1,verifyStatus:""},didMount:function(){this.initData(),this.props.onInit(),this.reset()},methods:{initData:function(){var t=this.store.state,e=t.config,a=t.$fetch;if(!e)throw new s.default(i.CONFIG_ERROR,"[core] config must not be null");this.$fetch=a},fetchCaptcha:(v=l(n.default.mark((function t(){var e,a,c,f,h,p,d,l;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.store.state,a=e.config,c=e.drp,f={id:a.captchaId,https:!0,type:a.captchaType,version:"1.0.1",drp:c,dev:r.DEVICE_TYPE.TOUCH,cb:(0,o.default)(),width:240,runEnv:r.RUNENV},h="/api/v2/mp/get",this.setData({verifyStatus:"loading"}),t.prev=4,t.next=7,this.$fetch({url:h,data:f,onTryError:(0,u.default)(a)});case 7:p=t.sent,d=p.data,this.store.commit("UPDATE_TOKEN",{token:d.token}),this.store.commit("UPDATE_TYPE",{captchaType:d.type}),this.setData({verifyStatus:"loaded"}),this.data.isReady||(this.props.onReady(),this.setData({isReady:!0})),t.next=20;break;case 15:t.prev=15,t.t0=t.catch(4),this.setData({verifyStatus:"loadFailed"}),l=new s.default(i.REQUEST_API_ERROR,t.t0.message,{url:h}),this.props.onError(l);case 20:case"end":return t.stop()}}),t,this,[[4,15]])}))),function(){return v.apply(this,arguments)}),verifyCaptcha:(y=l(n.default.mark((function t(){var e,a,p,d,l,y,v,m,E,R,S,T,w=this;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.data.verifyStatus||"loaded"===this.data.verifyStatus){t.next=2;break}return t.abrupt("return");case 2:return e=this.store.state,a=e.config,p=e.captchaType,d=e.token,l=[],y=(0,f.xor_encode)(d,[0,0,Date.now()-this.data.beginTime]+""),v={id:a.captchaId,token:d,type:p||"",version:"1.0.1",cb:(0,o.default)(),runEnv:r.RUNENV,width:240,data:JSON.stringify({d:"",m:(0,f.eypt)((0,h.sample)(l,r.SAMPLE_NUM).join(":")),p:(0,f.eypt)(y),ext:(0,f.eypt)((0,f.xor_encode)(d,"1,"+l.length))})},m="/api/v2/mp/check",E=function(t){var e=void 0;e=t?new s.default(i.REQUEST_API_ERROR,t.message,{url:m,token:d}):new s.default(i.BUSINESS_ERROR,"Failed to verify captcha.",{url:m}),w.setData({verifyStatus:"failed"}),w.props.onVerify([e])},this.setData({verifyStatus:"verifying"}),t.prev=9,t.next=12,this.$fetch({url:m,method:"POST",data:v,onTryError:(0,u.default)(a,{token:d})});case 12:R=t.sent,(S=R.data).result?(T=(0,c.default)((0,f.eypt)(S.validate+"::")),this.setData({verifyStatus:"success"}),this.props.onVerify([null,T])):E(),t.next=20;break;case 17:t.prev=17,t.t0=t.catch(9),E(t.t0);case 20:case"end":return t.stop()}}),t,this,[[9,17]])}))),function(){return y.apply(this,arguments)}),reset:function(){this.setData({beginTime:Date.now(),verifyStatus:""}),this.fetchCaptcha()}}})}},[[20,1,0]]]);