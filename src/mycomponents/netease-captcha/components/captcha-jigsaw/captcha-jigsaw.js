require("./../../runtime"),require("./../../common"),(my.neCaptchaJsonp=my.neCaptchaJsonp||[]).push([[5],{13:function(t,a,s){"use strict";var i=Object.assign||function(t){for(var a=1;a<arguments.length;a++){var s=arguments[a];for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(t[i]=s[i])}return t},e=s(5),d=s(3),r=g(s(4)),n=s(0),o=g(s(6));g(s(1));function g(t){return t&&t.__esModule?t:{default:t}}var h={status:"dragend",beginTime:0,clientX:0,startX:0,clientY:0,startY:0,left:0,startLeft:0,dragX:0};Component({mixins:[r.default],props:{loadInfo:{},wrapWidth:0,verifyStatus:"",jigsawCaptchaClass:"",onImageLoad:function(){},onVerify:function(){}},data:{slider:{width:0,icon:""},bgImgLoaded:!1,jigsawImg:{loaded:!1,left:0,width:0},drag:i({},h),traceData:[],mouseDownCounts:0,VERIFY_STATUS:n.VERIFY_STATUS,previousTime:0},didUpdate:function(t){var a=this.props.loadInfo,s=t.loadInfo;a.status!==s.status&&"loading"===a.status&&this.resetDrag();var i=this.props.verifyStatus;if(i!==t.verifyStatus){var e="";e=i===n.VERIFY_STATUS.ERROR?this.data.customStyles.controlBar.slideIconError:i===n.VERIFY_STATUS.SUCCESS?this.data.customStyles.controlBar.slideIconSuccess:this.data.customStyles.controlBar.slideIcon,this.setData({slider:Object.assign({},this.data.slider,{icon:e})})}},didMount:function(){var t=this.data.customStyles.controlBar.slideIcon;this.setData({slider:Object.assign({},this.data.slider,{icon:t})}),this.getSliderWidth()},methods:{resetDrag:function(){this.setData({drag:i({},h),traceData:[],mouseDownCounts:0,bgImgLoaded:!1,jigsawImg:{loaded:!1,left:0,width:0}})},getSliderWidth:function(){var t=this;my.createSelectorQuery().select(".query-slider-"+this.data.uuid).boundingClientRect().exec((function(a){var s=a[0];t.setData({slider:Object.assign({},t.data.slider,{width:s.width})})}))},readyToDrag:function(t){if(this.setData({mouseDownCounts:this.data.mouseDownCounts+1}),this.data.bgImgLoaded&&this.data.jigsawImg.loaded&&!this.props.verifyStatus){var a=t.changedTouches;"dragend"===this.data.drag.status&&this.setData({drag:Object.assign({},this.data.drag,{beginTime:Date.now(),clientX:a[0].clientX,startX:a[0].clientX,clientY:a[0].clientY,startY:a[0].clientY,dragX:0})})}},dragmove:function(t){var a=this.data.drag,s=a.status,i=a.beginTime,d=a.startX,r=a.dragX,n=a.startY,o=t.changedTouches[0],g=o.clientX,h=o.clientY,c=i&&g-d>3&&"dragend"===s?"dragstart":s;if("dragend"!==c){var l=this.props.loadInfo.data.token,u=(0,e.xor_encode)(l,[Math.round(r<0?0:r),Math.round(h-n),Date.now()-i].join(","));if(this.setData({drag:Object.assign({},this.data.drag,{clientX:g,clientY:h,dragX:g-d}),traceData:[].concat(this.data.traceData,[u])}),"dragstart"===c)this.setData({drag:Object.assign({},this.data.drag,{status:"dragging",startLeft:0})});else if("dragging"===c){t.timeStamp-this.data.previousTime>=80&&this.refreshUI(t.timeStamp)}}},refreshUI:function(t){var a=this.data.customStyles.controlBar.slideIconMoving,s=this.restrictWidth("slider",this.data.slider.width);this.setData({drag:Object.assign({},this.data.drag,{left:s}),jigsawImg:Object.assign({},this.data.jigsawImg,{left:this.restrictWidth("jigsaw",this.data.jigsawImg.width)}),slider:Object.assign({},this.data.slider,{icon:a||""}),previousTime:t})},endDrag:function(){if("dragend"!==this.data.drag.status){var t=(0,d.sample)(this.data.traceData,n.SAMPLE_NUM),a=this.props.loadInfo.data.token,s=(0,e.eypt)((0,e.xor_encode)(a,Number.parseInt(this.data.jigsawImg.left,10)/this.props.wrapWidth*100+""));this.verifyCaptcha({data:JSON.stringify({d:(0,e.eypt)(t.join(":")),m:"",p:s,ext:(0,e.eypt)((0,e.xor_encode)(a,this.data.mouseDownCounts+","+this.data.traceData.length))})}),this.setData({drag:i({},h,{left:this.data.drag.left})})}else this.setData({drag:Object.assign({},this.data.drag,{beginTime:0}),previousTime:0})},restrictWidth:function(t,a){var s=this.data.drag,i=s.startLeft,e=s.dragX,d=i+e,r=this.props.wrapWidth,n=r-a;if("jigsaw"===t){var o=void 0,g=this.data.slider.width,h=g-a,c=h<0?-h:h/2;e<=c?(o=e,d+=h<0?-o/2:e):r-e-g<=c?(o=e-(r-g-c),d+=(h<0?-o/2:o)+h/2):d+=h/2}return d<=0?d=0:d>=n&&(d=n),d},verifyCaptcha:function(t){this.props.onVerify({data:t,type:n.CAPTCHA_TYPE.JIGSAW})},handleBgImgLoaded:function(){this.setData({bgImgLoaded:!0}),this.data.jigsawImg.loaded&&this.props.onImageLoad(null)},handleImgLoadError:function(t){this.props.onImageLoad(i({},t.detail))},handleJigsawImgLoaded:function(t){this.setData({jigsawImg:{loaded:!0,left:0,width:t.width}}),this.data.bgImgLoaded&&this.props.onImageLoad(null)},handleImgTryError:function(t){var a=(0,o.default)(this.store.state.config,{token:this.props.loadInfo.data.token}),s=t.detail;a(s,i({},s.data))}}})}},[[13,1,0]]]);